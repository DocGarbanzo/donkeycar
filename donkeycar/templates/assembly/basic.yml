
parts:
  - cvcam:
      outputs: [cam/image_array]
      threaded: true
  - localwebcontroller:
      inputs: [cam/image_array, tub/current_index]
      outputs: [user/angle, user/throttle, user/mode, recording]
      threaded: true
  - checker:
      arguments:
        must_match: [local, local_angle]
      inputs: [user/mode]
      outputs: [run_pilot]
  - keraspilot:
      inputs: [cam/image_array]
      outputs: [pilot/angle, pilot/throttle]
      run_condition: run_pilot
  - dispatcher:
    # if run_pilot is true (i.e. == 1) return pilot/angle otherwise user/angle
      inputs: [run_pilot, user/angle, pilot/angle]
      outputs: [angle]
  - checker:
    # check if user/mode is user or local_angle because then we use user/throttle
      arguments:
        must_match: [user, local_angle]
      inputs: [user/mode]
      outputs: [use_user/throttle]
  - dispatcher:
    # if user_throttle is true return user/throttle else return pilot/throttle
      inputs: [use_user/throttle, pilot/throttle, user/throttle]
      outputs: [throttle]
  - pwmsteering:
      inputs: [angle]
  - pwmthrottle:
      inputs: [throttle]
  - tubwriter:
      arguments:
        inputs: [cam/image_array, user/angle, user/throttle, user/mode]
        types: [image_array, float, float, str]
      inputs: [cam/image_array, user/angle, user/throttle, user/mode]
      outputs: [tub/current_index]
      run_condition: recording
